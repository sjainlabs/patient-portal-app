<div>

<app-patient-header></app-patient-header>

<br>

  <div id="loadin">
    <app-loader-spin></app-loader-spin>
  </div>

  <div id="mainVisitHeader" class=" container ">
    <div id="newVisit">
    <label style="color: red"> {{error}}</label>

        <!--      <a routerLink="print" class="nav-link">-->
      <br>
      <div *ngIf="!newVisitFlag">
        <span>Please Click to Add a new Dr. Consult Visit- </span>

        <button type="submit" class="btn btn-primary" (click)="addVisit()">Consultation </button>
        <!--      </a>-->
      </div>
  </div>

  <div  >
    <table id="visitHeader">
      <tr>
        <td>Name : {{ searchData1.firstName }}</td>
        <td>DOB :  {{searchData1.dateOfBirth}}</td>
        <td>Patient Id : {{searchData1.id}}</td>
      </tr>

    </table>
  </div>
<br>



    <div class="p-2">
      <div class="card">
        <div class="card-header" (click)="isVitalsCollapsed=!isVitalsCollapsed" [attr.aria-expanded]="!isVitalsCollapsed"
             aria-controls="collapseExample1">
          Vital
        </div>
        <div  #collapse="ngbCollapse" [(ngbCollapse)]="isVitalsCollapsed">
          <div class="card-body">
            <img src="assets/icons8-edit.gif" (click)="editVitals()" style="float:right " title="edit me"/>
            <form  [formGroup]="vitalsFormData"  (ngSubmit)="onSubmitVitals()"  >
              <div>
                <label>Blood Pressure:
                  <input type="text" id="bloodPressure" name="bloodPressure" formControlName="bloodPressure" class="form-control" placeholder="130/60" [value]="patientVitalData.bloodPressure" [readonly]="isVitalsReadOnly">
                </label>
              </div>

              <div>
                <label>Temperature:
                  <input type="text" id="temperature" name="temperature" formControlName="temperature" class="form-control" placeholder="98ËšC" [value]="patientVitalData.temperature" [readonly]="isVitalsReadOnly">
                </label>
              </div>

              <div>
                <label>Weight:
                  <input type="text" id="weight" name="weight" formControlName="weight" class="form-control" placeholder="70kg" [value]="patientVitalData.weight" [readonly]="isVitalsReadOnly">
                </label>
              </div>

              <div>
                <label>Height:
                  <input type="text" id="height" name="height" formControlName="height" class="form-control" placeholder="" [value]="patientVitalData.height" [readonly]="isVitalsReadOnly">
                </label>
              </div>

              <div>
                <label>BMI:
                  <input type="text" id="bmi" name="bmi" formControlName="bmi" class="form-control" placeholder="" [value]="patientVitalData.bmi" [readonly]="isVitalsReadOnly">
                </label>
              </div>

              <div>
                <label>Oxygen Saturation:
                  <input type="text" id="O2Saturation" name="O2Saturation" class="form-control" formControlName="O2Saturation" placeholder="90%" [value]="patientVitalData.O2Saturation" [readonly]="isVitalsReadOnly">
                </label>
              </div>

              <div>
                <label>Pulse:
                  <input type="text" id="pulse" name="pulse" formControlName="pulse" class="form-control" placeholder="72" [value]="patientVitalData.pulse" [readonly]="isVitalsReadOnly">
                </label>
              </div>

              <button type="submit"
                      [disabled]="vitalsFormData.pristine || vitalsFormData.invalid" class="btn btn-success">
                Save
              </button>
            </form>

          </div>
        </div>
      </div>

      <Br>
      <div class="card">
        <div class="card-header" (click)="isNurseNotesCollapsed=!isNurseNotesCollapsed"
             [attr.aria-expanded]="!isNurseNotesCollapsed"
             aria-controls="collapseExample2">
          Nurse Notes
        </div>
        <div #collapse="ngbCollapse" [(ngbCollapse)]="isNurseNotesCollapsed">
          <div class="card-body">
              <img src="assets/icons8-edit.gif" (click)="editNurseNotes()" style="float:right " title="edit me"/>
              <form [formGroup]="nurseNotesFormData" (ngSubmit)="onSubmitNurseNotes()"  >
                <div>
                  <label>Known Allergies:
                    <input type="text" id="allergies" name="allergies" formControlName="allergies" class="form-control" placeholder="Any Known Allergies like Pollen" [value]="currentMedicalData.allergies" [readonly]="isNurseNotesReadOnly">
                  </label>
                </div>

                <div>
                  <label>Referral From :
                    <input type="text" id="referredFrom" name="referredFrom" formControlName="referredFrom" class="form-control" placeholder="Referred from Hospital/Doctor" [value]="currentMedicalData.referredFrom" [readonly]="isNurseNotesReadOnly">
                  </label>
                </div>

                <div>
                  <label>Current Medication:
                    <input type="text" id="currentMedication" name="currentMedication" formControlName="currentMedication" class="form-control" placeholder="Ongoing or Current Medication" [value]="currentMedicalData.currentMedication" [readonly]="isNurseNotesReadOnly">
                  </label>
                </div>

                <div>
                  <label>Current Concern:
                    <input type="text" id="currentConcern" name="currentConcern" formControlName="currentConcern" class="form-control" placeholder="Fever , Headache etc" [value]="currentMedicalData.currentConcern" [readonly]="isNurseNotesReadOnly">
                  </label>
                </div>

                <div>
                  <label>Reason For Visit:
                    <input type="text" id="reasonForVisit" name="reasonForVisit" formControlName="reasonForVisit" class="form-control" placeholder="Routine Checkup, Follow-up etc" [value]="currentMedicalData.reasonForVisit" [readonly]="isNurseNotesReadOnly">
                  </label>
                </div>

                <div>
                  <label>Additional Notes:
                    <input type="text" id="additionalNurseNotes" name="additionalNurseNotes" formControlName="additionalNurseNotes" class="form-control" placeholder="" [value]="currentMedicalData.reasonForVisit" [readonly]="isNurseNotesReadOnly">
                  </label>
                </div>



                <button type="submit"
                        [disabled]="nurseNotesFormData.pristine || nurseNotesFormData.invalid" class="btn btn-success">
                  Save
                </button>
              </form>
          </div>
        </div>
      </div>
    </div>

    <br>

    <div  *ngIf="error=='' && !newVisitFlag">
    <table id="visits" class="table" >
      <thead>
      <tr>
        <th>Visit Date</th>
        <th>Symptoms</th>
        <th>Prescription</th>
        <th>FollowUp Date</th>
        <th>Notes</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let visit of patientVisitData">
        <td>{{visit.visitDate}} </td>
        <td>{{visit.symptoms}} </td>
        <td>{{visit.prescription}} </td>
        <td >{{visit.followUpDate}} </td>
        <td>{{visit.notes}} </td>
      </tr>

      </tbody>
    </table>
    </div>
  </div>


    <div *ngIf="newVisitFlag && error==''">
      <form  [formGroup]="visitFormData"
            (ngSubmit)="onSubmitVisit(visitFormData.value)" >


        <div>
          <label>Symptoms * :
            <textarea type="text" id="symptoms" name="symptoms" formControlName="symptoms" required class="form-control" rows="5" cols="50" placeholder="Fever,Cold ,Nausea etc..." ></textarea>
          </label>
          <div *ngIf="visitFormData.controls['symptoms'].invalid && (visitFormData.controls['symptoms'].dirty
             || visitFormData.controls['symptoms'].touched)" class="alert alert-danger">
            <div *ngIf="visitFormData.controls['symptoms'].errors.required">
              Symptoms  is required.
            </div>
          </div>
        </div>

        <div>
          <label>Prescription *:
            <textarea type="text" id="prescription" name="prescription"  formControlName="prescription"  required class="form-control" rows="5" cols="50" placeholder="paracetamol, ibuprofen etc" ></textarea>
            <div *ngIf="visitFormData.controls['prescription'].invalid && (visitFormData.controls['prescription'].dirty
             || visitFormData.controls['prescription'].touched)" class="alert alert-danger">
              <div *ngIf="visitFormData.controls['prescription'].errors.required">
                prescription  is required.
              </div>
            </div>
          </label>
        </div>

        <div>
          <label>Followup Days:
            <input type="text" formControlName="followUpDays" class="form-control" (keypress)="patientHelper.numberOnly($event)" placeholder="7">
          </label>
        </div>

        <div>
          <label>Notes:
            <textarea type="text" formControlName="notes" class="form-control"  rows="3" cols="50" placeholder="Additiona Notes - Blood work,X-Ray needed, Referral to a speaciaist etc">
            </textarea>
          </label>
        </div>

        <button type="submit"
                [disabled]="visitFormData.pristine || visitFormData.invalid" class="btn btn-success">
          Submit
        </button>

      </form>
  </div>
</div>


